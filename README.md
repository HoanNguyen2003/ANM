## Installation

1. Clone this repository
2. Install the required dependencies:

```
pip install -r requirements.txt
```

## Usage

The basic usage is:

```
python webhook_catch_final_v3.py -l <log_file> -t <log_type> [options]
```

### Example

```
python webhook_catch_final_v3.py -l SAMPLE_DATA/RAW_APACHE_LOGS/access.log -t apache -o -p
```

### Options

- `-l, --log_file`: The raw log file (required)
- `-t, --log_type`: Log type: apache, http, nginx, or os_processes (required)
- `-e, --eps`: DBSCAN Epsilon value (max distance between two points)
- `-s, --min_samples`: Minimum number of points in a cluster
- `-j, --log_lines_limit`: Maximum number of log lines to consider
- `-y, --opt_lamda`: Optimization lambda step
- `-m, --minority_threshold`: Minority clusters threshold
- `-p, --show_plots`: Show informative plots
- `-o, --standardize_data`: Standardize feature values
- `-r, --report`: Create an HTML report
- `-z, --opt_silouhette`: Optimize DBSCAN silhouette coefficient
- `-b, --debug`: Activate debug logging
- `-c, --label_encoding`: Use label encoding instead of frequency encoding
- `-v, --find_cves`: Find CVEs related to attack traces
- `-n, --n_components`: Number of components for PCA (default: 2)

## Files

- `webhook_catch_final_v3.py`: The main script with all fixes applied
- `utilities_fixed.py`: Utility functions for parsing and processing logs
- `settings.conf`: Configuration file for log formats and feature definitions
- `test_final_fix.py`: Test script to validate the fixes

## Original README Content

The tool is able to parse both raw HTTP log files (Apache, Nginx, ...) and files including OS statistics (generated by top command). The tool takes these files as input and returns a report with a list of findings.

Catch uses PCA (Principal Component Analysis) technique to select the most relevant features (Example: user-agent, IP address, number of transmitted parameters, etc.). Then, it runs DBSCAN (Density-Based Spatial Clustering of Applications with Noise) algorithm to get all the possible log line clusters and anomalous points (potential attack traces).

Advanced users can fine tune Catch based on a set of options that help optimising the clustering algorithm (Example: minimum number of points by cluster, or the maximum distance between two points within the same cluster).

The current version of Webhawk/Catch generates an easy-to-read HTML report which includes all the findings, and the severity of each one.

Webhawk/Catch is an open-source tool. Catch is the unsupervised version of Webhawk which is a supervised machine learning based cyber-attack detection tool. In contrary to the supervised Webhawk, Catch can be used without manually pertaining a model, the thing that makes it a lightweight and flexible solution to easily identify potential attack traces.

## Example with apache logs

```shell
python webhook_catch_final_v3.py -l SAMPLE_DATA/RAW_APACHE_LOGS/access.log -t apache -p -o -r
```

## Example with OS processes

Before running the script, you need to generate a .txt file containing the OS process statistics by taking advantage of top command:

```shell
top > PATH/os_processes.txt
```

You can then run the script to detect potential abnormal OS processes:

```shell
python webhook_catch_final_v3.py -l PATH/os_processes.txt -t os_processes -p -o -r
```

## License

This project is licensed under the MIT License.

## Author

- Original author: walid.daboubi@gmail.com
- Last reviewed: 2023/08/06
- Last fixed: 2025/05/18
